@{
    Layout = "~/Views/Shared/defaultAuthor.cshtml";
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Home - Pintereso Bootstrap Template</title>
    <script type="text/javascript">(function () { var css = document.createElement('link'); css.href = 'https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'; css.rel = 'stylesheet'; css.type = 'text/css'; document.getElementsByTagName('head')[0].appendChild(css); })();</script>
    <link href="~/Assets/template-pintereso-bootstrap-html-master/docs/assets/css/app.css" rel="stylesheet" />
    <link href="~/Assets/template-pintereso-bootstrap-html-master/docs/assets/css/theme.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">
  
    <style>
        .search-button {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            background-color: transparent;
            border: none;
            cursor: pointer;
        }

            .search-button img {
                width: 24px;
                height: 24px;
            }

        .product {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }

        .navbar-light button {
            width: 40px; /* Đặt kích thước mong muốn */
            height: 40px;
            border-radius: 50%; /* Tạo hình tròn */
            overflow: hidden; /* Đảm bảo hình tròn không bị tràn ra ngoài nếu có nội dung bên trong */
            display: flex;
            align-items: center;
            justify-content: center;
            border: none; /* Loại bỏ đường viền */
            background-color: transparent; /* Điều chỉnh màu nền tùy thuộc vào thiết kế của bạn */
        }

            /* Điều chỉnh kích thước của hình ảnh trong nút */
            .navbar-light button img {
                width: 100%; /* Hình ảnh chiếm toàn bộ kích thước của nút */
                height: auto;
                border-radius: 50%; /* Đảm bảo hình ảnh cũng là hình tròn */
            }

            /* Hiệu ứng khi di chuột vào nút */
            .navbar-light button:hover {
                background-color: #f8f9fa; /* Màu nền khi di chuột vào */
                transition: background-color 0.3s ease; /* Hiệu ứng chuyển đổi */
            }

        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        /* Styles for close button */
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }
    </style>

    <script type="text/javascript">
        (function () {
            var css = document.createElement('link');
            css.href = 'https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css';
            css.rel = 'stylesheet';
            css.type = 'text/css';
            document.getElementsByTagName('head')[0].appendChild(css);
        })();
    </script>
</head>

<body>
   
    <main role="main">



        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>


        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script>
          
           


            function openArtPopup() {

                // Create a Bootstrap modal for the popup
                var modal = `
                                            <div class="modal" id="artPopup" tabindex="-1" role="dialog">
                                                <div class="modal-dialog" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title">Add Your Art</h5>
                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>
                                                        <div class="modal-body">

                                                            <label for="artName">Art Name:</label>
                                                            <input type="text" id="artName" class="form-control mb-2">

                                                            <label for="artDescription">Description:</label>
                                                             <input type="text" id="artDescription" class="form-control mb-2">

                                                            <label for="artPrice">Price:</label>
                                                            <input type="number" id="artPrice" class="form-control mb-2">
                                                             <label for="Quantity">Quantity:</label>
                                                             <input type="number" id="Quantity" class="form-control mb-2">

                                                            <label for="artImage">Select Image:</label>
                                                            <input type="file" id="artImage" accept="image/*,.png" class="form-control mb-2">
                                                            <label for="artGenre">Art Genre:</label>
                                                            <select id="artGenre" class="form-control mb-2">
                                                                <option value="1">Landscape</option>
                                                                <option value="4">Lifestyle</option>
                                                                <option value="5">Animation</option>
                                                                <option value="6">Portrait</option>
                                                                <option value="7">Scenery</option>
                                                             </select>

                                                        </div>
                                                         <div class="modal-footer">
                                                    <button type="button" class="btn btn-primary" onclick="saveArtwork()">Save</button>
                                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                </div>
                                                    </div>
                                                </div>
                                            </div>
                                        `;

                // Append the modal HTML to the body
                $('body').append(modal);

                // Show the modal
                $('#artPopup').modal('show');

                // Remove the modal from the DOM when it's closed
                $('#artPopup').on('hidden.bs.modal', function () {
                    $(this).remove();
                });

            }
            function saveArtwork() {
                // Get values from input fields
                var ArtName1 = document.getElementById('artName').value;
                var descriptionArt = document.getElementById('artDescription').value;
                var quantityArt = document.getElementById('Quantity').value;
                var price = $('#artPrice').val();
                var userID = sessionStorage.getItem('userId'); // Replace this with your actual logic to get user ID
                // Placeholder for base64-encoded image data, to be set later
                var artGenreSelect = document.getElementById('artGenre');
                var artGenre = artGenreSelect.options[artGenreSelect.selectedIndex].value;
                // Read and encode the selected image
                var fileInput = document.getElementById('artImage');
                var selectedFile = fileInput.files[0];

                if (selectedFile) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        // Base64-encoded image data
                        var codePictureArtworkWithPrefix = e.target.result;

                        // Xóa tiền tố "data:image/jpeg;base64,"
                        var codePictureArtwork = codePictureArtworkWithPrefix.replace(/^data:image\/(png|jpeg);base64,/, '');
                        // Call the API using AJAX
                        $.ajax({
                            type: 'POST',
                            url: 'https://localhost:7008/api/Arwork/AddArtwork', // Replace with your actual API endpoint
                            data: JSON.stringify({
                                contentArtwork: ArtName1,
                                description: descriptionArt,
                                priceArtWork: price,
                                genreId: artGenre,
                                userId: userID,
                                pictureArtwork: codePictureArtwork,
                                quanity: quantityArt,
                                status: true
                            }),
                            contentType: 'application/json',
                            success: function (data) {
                                // Handle success response from the API
                                console.log('Artwork saved successfully:', data);
                                // Optionally, close the modal after successful save
                                location.reload();

                                $('#artPopup').modal('hide');
                            },
                            error: function (error) {
                                // Handle error response from the API
                                console.error('Error saving artwork:', error);
                            }
                        });
                    };

                    // Read the image file as a data URL
                    reader.readAsDataURL(selectedFile);
                }
            }
        </script>
        <section class="mt-4 mb-5">
            <div class="container mb-4">
                <h1 class="font-weight-bold title">Explore</h1>
                <div class="row">
                    <nav class="navbar navbar-expand-lg navbar-light bg-white pl-2 pr-2">
                        <button class="navbar-light navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExplore" aria-controls="navbarsDefault" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <button class="navbar-light button" type="button" onclick="openArtPopup()">
                            <img src="https://img.icons8.com/ios/150/000000/plus-math.png" alt="Plus Icon">
                        </button>
                        <div class="collapse navbar-collapse" id="navbarsExplore">
                            <ul class="navbar-nav active">
                                <li class="nav-item">
                                    <a class="nav-link" onclick="SortType('Lifestyle')" href="#">Lifestyle</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" onclick="SortType('Animation')" href="#">Animation</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" onclick="SortType('Portrait')" href="#">Portrait</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" onclick="SortType('Scenery')" href="#">Scenery</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" onclick="SortType('Monumental')" href="#">Monumental</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" onclick="SortType('Folk')" href="#">Folk</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" onclick="SortType('Promote')" href="#">Promote</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" onclick="SortType('Religious')" href="#">Religious</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" onclick="SortType('Shui')" href="#">Shui</a>
                                </li>
                                <ul class="navbar-nav mr-auto align-items-center">
                                    <form class="bd-search hidden-sm-down">
                                        <input type="text" class="form-control bg-graylight border-0 font-weight-bold" id="search-input" placeholder="Search..." autocomplete="off">

                                        <button type="button" onclick="search()" class="search-button">
                                            <img src="https://img.icons8.com/?size=24&id=1649&format=png" alt="Search Icon">
                                        </button>
                                    </form>

                                </ul>
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row">
                    <div class="card-columns">
                        <div id="apiDataContainer"></div>
                        <script>
                            function SortType(genre) {
                                $.ajax({
                                    type: 'GET',
                                    url: `https://localhost:7008/api/Arwork/GetArtworkByGenre?genre=${genre}`,
                                    success: function (response) {
                                        $('#apiDataContainer').empty();
                                        // Hiển thị dữ liệu từ API lên trang
                                        if (response && Array.isArray(response) && response.length > 0) {
                                            // Iterate through each artwork in the response
                                            response.forEach(function (artwork) {
                                                const strHTML = `
                                                <div class="card card-pin">
                                                    <img class="card-img" src="data:image/png;base64, ${artwork.pictureArtwork}" alt="Artwork image">
                                                        <div class="overlay">
                                                            <h2 class="card-title title">${artwork.contentArtwork}</h2>
                                                                <div class="more">
                                                                    <a href="#" class="more-btn" data-artworkid="${artwork.artworkPId}">
                                                                        <i class="fa fa-arrow-circle-o-right" aria-hidden="true"></i> More
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                `;

                                                $('#apiDataContainer').append(strHTML);
                                                // Thêm sự kiện click cho nút "More"
                                                $('.more-btn').click(function (e) {
                                                    e.preventDefault();
                                                    const artworkId = $(this).data('artworkid');
                                                    sessionStorage.setItem('artworkID', artworkId);
                                                    // Chuyển đến trang Manage_Post với artworkId
                                                    window.location.href = `Manage_Post?artworkid=${artworkId}`;
                                                });
                                            });
                                        } else {
                                            console.error('Invalid or empty response from the API.');
                                        }
                                    },
                                    error: function (error) {
                                        console.error('Lỗi:', error);
                                    }
                                });
                            }
                            function search() {
                                // Kiểm tra nếu phím được nhấn là Enter (mã phím 13)

                                // Lấy truy vấn tìm kiếm từ trường nhập liệu
                                var searchQuery = $('#search-input').val();

                                // Kiểm tra nếu truy vấn tìm kiếm không rỗng
                                if (searchQuery !== '') {

                                    // Gọi API của bạn sử dụng AJAX
                                    $.ajax({
                                        type: 'GET',
                                        url: `https://localhost:7008/api/Arwork/SearchContenArtwork?content=${searchQuery}`,
                                        success: function (response) {
                                            $('#apiDataContainer').empty();
                                            alert(searchQuery);
                                            console.log(response.dataObject);
                                            // Hiển thị dữ liệu từ API lên trang
                                            if (response.dataObject && Array.isArray(response.dataObject) && response.dataObject.length > 0) {
                                                // Duyệt qua mỗi tác phẩm nghệ thuật trong phản hồi
                                                response.dataObject.forEach(function (artwork) {  // Thay đổi từ SearchArtwork thành artwork
                                                    const strHTML = `
<div class="card card-pin">
    <img class="card-img" src="data:image/png;base64, ${artwork.pictureArtwork}" alt="Artwork image">
    <div class="overlay">
        <h2 class="card-title title">${artwork.contentArtwork}</h2>
        <div class="more">
            <a href="#" class="more-btn" data-artworkid="${artwork.artworkPId}">
                <i class="fa fa-arrow-circle-o-right" aria-hidden="true"></i> More
            </a>
        </div>
    </div>
</div>
`;

                                                    $('#apiDataContainer').append(strHTML);
                                                    // Thêm sự kiện click cho nút "More"
                                                    $('.more-btn').click(function (e) {
                                                        e.preventDefault();
                                                        const artworkId = $(this).data('artworkid');
                                                        sessionStorage.setItem('artworkID', artworkId);
                                                        // Chuyển đến trang Manage_Post với artworkId
                                                        window.location.href = `Manage_Post?artworkid=${artworkId}`;
                                                    });
                                                });
                                            } else {
                                                console.error('Phản hồi từ API không hợp lệ hoặc trống.');
                                            }
                                        },
                                        error: function (error) {
                                            console.error('Lỗi:', error);
                                        }
                                    });
                                }
                                else if (searchQuery == '') {
                                    location.reload();
                                }
                            }
                            $(document).ready(function () {
                                $.ajax({
                                    type: 'GET',
                                    url: 'https://localhost:7008/api/Arwork/GetAllArtwork',
                                    success: function (response) {
                                        console.log(response);
                                        console.log(sessionStorage.getItem('userId'));
                                        if (response && Array.isArray(response) && response.length > 0) {
                                            // Iterate through each artwork in the response
                                            response.forEach(function (artwork) {
                                                const strHTML = `
                                                   <div class="card card-pin">
                                                        <img class="card-img" src="data:image/png;base64, ${artwork.pictureArtwork}" alt="Artwork image">
                                                             <div class="overlay">
                                                                <h2 class="card-title title">${artwork.contentArtwork}</h2>
                                                                    <div class="more">
                                                                        <a href="#" class="more-btn" data-artworkid="${artwork.artworkPId}">
                                                                    <i class="fa fa-arrow-circle-o-right" aria-hidden="true"></i> More
                                                                        </a>
                 </div>
             </div>
         </div>`
                                                    ;

                                                $('#apiDataContainer').append(strHTML);
                                                // Thêm sự kiện click cho nút "More"
                                                $('.more-btn').click(function (e) {
                                                    e.preventDefault();
                                                    const artworkId = $(this).data('artworkid');
                                                    sessionStorage.setItem('artworkID', artworkId);
                                                    // Chuyển đến trang Manage_Post với artworkId
                                                    window.location.href = `Manage_Post?artworkid=${artworkId}`;
                                                });
                                            });

                                        } else {
                                            console.error('Invalid or empty response from the API.');
                                        }
                                    },
                                    error: function (error) {
                                        console.error('Error:', error);
                                    }
                                });
                            });

                        </script>
                    </div>

                </div>
            </div>
        </section>

    </main>


</body>

</html>